{% extends 'base.html.twig' %}

{% block title %}Films populaires - Page {{ current_page }}{% endblock %}

{% block body %}
    <!-- Content -->
    <main class="relative z-10 max-w-5xl mx-auto px-6 md:px-8 pt-28 pb-16">
        <!-- Header -->
        <div class="mb-10">
            <h1 class="text-4xl md:text-5xl font-extralight tracking-tight text-white mb-3">
                Films <span class="bg-[linear-gradient(135deg,#818cf8,#c084fc,#f472b6)] bg-clip-text text-transparent [-webkit-text-fill-color:transparent] font-light">populaires</span>
            </h1>
            <p class="text-white/40 font-light tracking-wide">
                Découvrez les films les mieux notés selon les scores du public mondial.
            </p>
        </div>

        <!-- Movie List -->
        <div class="flex flex-col gap-5">
            {% for movie in movies %}
                <article class="flex flex-col sm:flex-row gap-5 p-5 bg-white/4 backdrop-blur-xl border border-white/8 rounded-[28px] transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] hover:border-white/15 hover:-translate-y-0.5 hover:scale-[1.01] hover:shadow-[0_20px_60px_rgba(99,102,241,0.08),0_8px_24px_rgba(168,85,247,0.06)]">
                    <!-- Poster -->
                    <div class="shrink-0 w-full sm:w-32 rounded-[18px] overflow-hidden">
                        {% if movie.poster_path %}
                            <img src="{{ tmdb_image_base_url ~ movie.poster_path }}"
                                 alt="{{ movie.title }}"
                                 class="w-full aspect-2/3 object-cover"
                                 loading="lazy">
                        {% else %}
                            <div class="w-full aspect-2/3 bg-white/5 rounded-[18px] flex items-center justify-center text-white/20 text-xs">Pas d'image</div>
                        {% endif %}
                    </div>

                    <!-- Details -->
                    <div class="flex-1 min-w-0 flex flex-col justify-center">
                        <h2 class="text-xl font-light text-white tracking-wide mb-2">{{ movie.title }}</h2>
                        <div class="flex flex-wrap items-center gap-3 mb-4">
                            <span class="text-sm text-white/40 font-light">{{ movie.release_date|slice(0, 4) }}</span>
                            <span class="rounded-full px-3 py-1 text-xs text-yellow-300/90 flex items-center gap-1 border border-yellow-400/25 bg-[linear-gradient(135deg,rgba(250,204,21,0.15),rgba(251,146,60,0.15))]">
                                ★ {{ movie.vote_average|number_format(1) }}
                            </span>
                            <span class="text-xs text-white/25 font-light">{{ movie.vote_count }} votes</span>
                        </div>
                        <p class="text-white/50 text-sm font-light leading-relaxed">{{ movie.overview }}</p>
                    </div>
                </article>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <nav class="flex items-center justify-center gap-2 mt-12">
            {% if current_page > 1 %}
                <a href="{{ path('movie_top_rated_list', {page: current_page - 1}) }}"
                   class="rounded-full px-5 py-2 text-sm text-white/60 hover:text-white bg-white/4 backdrop-blur-xl border border-white/8 hover:bg-white/10 transition-all duration-400">&laquo;</a>
            {% endif %}

            {% set start_page = max(1, current_page - 2) %}
            {% set end_page = min(total_pages, current_page + 2) %}

            {% if start_page > 1 %}
                <a href="{{ path('movie_top_rated_list', {page: 1}) }}"
                   class="rounded-full px-5 py-2 text-sm text-white/60 hover:text-white bg-white/4 backdrop-blur-xl border border-white/8 hover:bg-white/10 transition-all duration-400">1</a>
                {% if start_page > 2 %}
                    <span class="text-white/20 px-1">...</span>
                {% endif %}
            {% endif %}

            {% for p in start_page..end_page %}
                {% if p == current_page %}
                    <span class="rounded-full px-5 py-2 text-sm text-white font-medium bg-[linear-gradient(135deg,#6366f1,#a855f7)] shadow-[0_4px_20px_rgba(99,102,241,0.3)]">{{ p }}</span>
                {% else %}
                    <a href="{{ path('movie_top_rated_list', {page: p}) }}"
                       class="rounded-full px-5 py-2 text-sm text-white/60 hover:text-white bg-white/4 backdrop-blur-xl border border-white/8 hover:bg-white/10 transition-all duration-400">{{ p }}</a>
                {% endif %}
            {% endfor %}

            {% if end_page < total_pages %}
                {% if end_page < total_pages - 1 %}
                    <span class="text-white/20 px-1">...</span>
                {% endif %}
                <a href="{{ path('movie_top_rated_list', {page: total_pages}) }}"
                   class="rounded-full px-5 py-2 text-sm text-white/60 hover:text-white bg-white/4 backdrop-blur-xl border border-white/8 hover:bg-white/10 transition-all duration-400">{{ total_pages }}</a>
            {% endif %}

            {% if current_page < total_pages %}
                <a href="{{ path('movie_top_rated_list', {page: current_page + 1}) }}"
                   class="rounded-full px-5 py-2 text-sm text-white/60 hover:text-white bg-white/4 backdrop-blur-xl border border-white/8 hover:bg-white/10 transition-all duration-400">&raquo;</a>
            {% endif %}
        </nav>
    </main>

    <!-- Footer -->
    <footer class="relative z-10 bg-[rgba(10,10,18,0.6)] backdrop-blur-2xl border-t border-white/8 py-6 text-center">
        <p class="text-white/30 text-sm font-light tracking-wide">
            CinemaDB — Propulsé par TMDB
        </p>
    </footer>
{% endblock %}
